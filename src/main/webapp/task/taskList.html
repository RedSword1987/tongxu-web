<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>数据抓取</title>
    <meta http-equiv="pragma" content="no-cache">
    <!-- HTTP 1.0 -->
    <meta http-equiv="cache-control" content="no-cache">
    <!-- Prevent caching at the proxy server -->
    <meta http-equiv="expires" content="0">

    <link href="../gentelella-master/vendors/bootstrap/dist/css/bootstrap.min.css?v=20160907"
          rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../gentelella-master/vendors/font-awesome/css/font-awesome.min.css?v=20160907"
          rel="stylesheet">
    <!-- bootstrap-progressbar -->
    <link href="../gentelella-master/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css?v=20160907"
          rel="stylesheet">
    <!-- jVectorMap -->
    <link href="../gentelella-master/production/css/maps/jquery-jvectormap-2.0.3.css?v=20160907"
          rel="stylesheet"/>
    <!-- Custom Theme Style -->
    <link href="../gentelella-master/production/css/custom.css?v=20160907"
          rel="stylesheet">
    <link href="../gentelella-master/vendors/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css?v=20160907"
          rel="stylesheet">

    <link href="../gentelella-master/vendors/bootstrap-table/bootstrap-table.css?v=20160907"
          rel="stylesheet">
    <!-- showLoading-->
    <link href="../gentelella-master/vendors/jquery-showLoading/css/showLoading.css?v=20160907"
          rel="stylesheet">
    <!-- jquery-confirm-->
    <link href="../gentelella-master/vendors/jquery-confirm/jquery-confirm.min.css?v=20160907"
          rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../gentelella-master/production/css/common.css?v=20160907"
          rel="stylesheet">


</head>
<body class="nav-md">
<div class="container body">
    <div class="main_container">
        <div  role="main" >
            <div class="col-md-12 col-sm-12 col-xs-12" style="min-height: 400px!important;">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>任务列表</h2>

                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <form id="btn_search_content" style="display: none;" data-parsley-validate class="form-horizontal form-label-left">

                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-2"> 任务名称 :</label>
                                <div class="col-md-3 col-sm-3 col-xs-3">
                                    <input type="text" id="searchForm_taskName----1" class="form-control col-md-3 col-xs-3">
                                </div>

                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-2">任务类型 : </label>
                                <div class="col-md-2 col-sm-2 col-xs-2">
                                    <select id="searchForm_type----2" class="form-control">
                                        <option value=""></option>
                                        <option value="1">订单主数据</option>
                                        <option value="2">订单明细数据</option>
                                    </select>
                                </div>

                                <label class="control-label col-md-2 col-sm-2 col-xs-2">状态 : </label>
                                <div class="col-md-2 col-sm-2 col-xs-2">
                                    <select id="searchForm_status----2" class="form-control">
                                        <option value=""></option>
                                        <option value="1">待执行</option>
                                        <option value="2">执行结束</option>
                                    </select>
                                </div>

                            </div>

                            <div class="ln_solid"></div>
                            <div class="form-group">
                                <div class="col-md-8 col-sm-8 col-xs-8  ">
                                    <button id="btn_search_action" class="btn btn-primary" type="button">
                                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索
                                    </button>

                                </div>
                            </div>
                        </form>
                        <div id="toolbar" class="btn-group">
                            <div>
                                <button id="btn_search" type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索
                                </button>
                                <button id="btn_add" type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-import" aria-hidden="true"></span>添加任务
                                </button>
                                <button id="btn_edit" type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>重新执行
                                </button>
                                <button id="btn_delete" type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                                </button>

                            </div>
                        </div>

                        <table id="bootstrap-table">
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- jQuery -->
<script src="../gentelella-master/vendors/jquery/dist/jquery.min.js?v=20160907"></script>
<!-- Bootstrap -->
<script src="../gentelella-master/vendors/bootstrap/dist/js/bootstrap.min.js?v=20160907"></script>
<!-- bootstrap-daterangepicker -->
<script src="../gentelella-master/production/js/moment/moment.min.js"></script>
<script src="../gentelella-master/production/js/datepicker/daterangepicker.js"></script>
<!-- Custom Theme Scripts -->
<script src="../gentelella-master/production/js/custom.js"></script>
<!--   -->
<!--   -->
<!-- 时间控件  -->
<script src="../gentelella-master/vendors/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
<script src="../gentelella-master/vendors/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"
        charset="UTF-8"></script>
<!--   -->
<!--   -->
<!-- showLoading -->
<script src="../gentelella-master/vendors/jquery-showLoading/js/jquery.showLoading.min.js"></script>
<!-- jquery-confirm -->
<script src="../gentelella-master/vendors/jquery-confirm/jquery-confirm.min.js"></script>
<!--   -->
<!-- 另外导入 -->
<script src="../gentelella-master/vendors/bootstrap-table/bootstrap-table.js"></script>
<script src="../gentelella-master/vendors/bootstrap-table/bootstrap-table-zh-CN.js"></script>
<script src="../gentelella-master/vendors/jquery-cookie/jquery.cookie.js"></script>
<!-- 自己项目的js -->
<script src="../common/js/common.js?v=20160907"></script>
<script src="../common/js/common_forTable.js?v=20160907"></script>
<script src="../common/js/common_forModal.js?v=20160907"></script>
<script src="../common/js/common_ajax.js?v=20160907"></script>


<div id="fakeloader"></div>
<script type="text/javascript">

    var getTypeSelect = function () {
        var brand_content = ' <option value="2">订单明细数据</option><option value="1">订单主数据</option>';
        return brand_content;
    }

    function formatter_taskStatus(value,row,index){
        if(value){
            value=value+'';
            if(value=='1'){
                return '未执行';
            }else if(value=='2'){
                return '<a href="/task/taskResult.html?id='+row.id+'" target="_blank">'+'已执行(查看结果)'+'</a>';
            }else if(value=='2'){
                return '已删除';
            }
        }
        return value;
    }

    function formatter_taskType(value,row,index){
        if(value){
            value=value+'';
            if(value=='1'){
                return '订单主数据';
            }else if(value=='2'){
                return '订单明细数据';
            }
        }
        return value;
    }

    function formatter_taskTypeNum(value,row,index){
        if(value){
            value=value+'';
            if(value.indexOf("-")==-1&&value!=0){
                return '<a href="/task/taskResult.html?id='+row.id+'" target="_blank">'+value+'</a>';
            }
        }
        return value;
    }


    var columns = [ {  checkbox: true },
        {field: "id", title: "ID",  class: "th_id",sortable:"true",},
        {field: "type", title: "任务类型", class: "th_100", formatter: formatter_taskType, sortable: "true"},
        {field: "taskName", title: "任务名称", class: "th_100", sortable: "true"},
        {field: "typeNum", title: "源订单数量", class: "th_100", formatter: formatter_taskTypeNum, sortable: "true"},
        {field: "beginDate", title: "开始时间",  class: "th_time",formatter:formatter_datetime ,sortable:"true"},
        {field: "endDate", title: "结束时间",  class: "th_time",formatter:formatter_datetime ,sortable:"true"},
        {field: "status", title: "状态",  class: "th_ka",formatter:formatter_taskStatus,sortable:"true"},
        {field: "createdAt", title: "任务创建时间",  class: "th_time",formatter:formatter_datetime,sortable:"true"}

    ];

    var idField = "id";
    var url_prefix = "/task/taobao/";
    var url_page = url_prefix + "listTask.action";

    //此处不需要修改
    var tableId = "bootstrap-table";


    $(function () {
        //添加按钮
        $("#btn_search").click(function(){
            if(!$("#btn_search_content").is(":hidden")){

            }else{

            }

            $("#btn_search_content").toggle();
            $("#btn_search_action").unbind("click");
            $("#btn_search_action").click(function(){
                $('#bootstrap-table').bootstrapTable("refresh");
            });

        });


        initPage(tableId, idField, url_page, columns);

        $(window).resize(function () {
            $('#bootstrap-table').bootstrapTable('resetView');
        });


        //添加按钮
        $("#btn_add").click(function () {
            var now = new Date();
            var dateYes = new Date();
            dateYes.setDate(dateYes.getDate() - 1);
            var defaultValueDate = dateYes.CCFormat("yyyy-MM-dd hh:mm:ss");
            var nowDefaultValueDate = now.CCFormat("yyyy-MM-dd hh:mm:ss");
            var getDataFields = [
                {field: "type", title: "任务类型", require: true, fileType: 10, select_content: getTypeSelect()},
                {field: "taskName", title: "任务名称", require: true},
                {field: "beginDateS", title: "开始日期", require: true, fileType: 23, defaultValue: defaultValueDate},
                {field: "endDateS", title: "结束日期", require: true, fileType: 23, defaultValue: nowDefaultValueDate},
                {field: "orderIds", title: "订单编号", require: true, fileType: 27},

            ];
            // $("#addModal").modal('show')
            initAddModal(getDataFields);
            initTypeChoose($("#addForm_type").val());
            $("#addForm_type").change(function () {
                initTypeChoose($(this).val());
            });

            $('#addModal_save').unbind("click");
            $("#addModal_save").click(function () {
                var taskName = $.trim($("#addForm_taskName").val());
                var beginDate = $("#addForm_beginDateS").val();
                var endDate = $("#addForm_endDateS").val();
                var orderIds = $.trim($("#addForm_orderIds").val());
                var check_ = 1;
                if ('' == taskName) {
                    alert("任务名称 不可为空");
                    check_ = 0;
                }
                var type_value = $("#addForm_type").val();

                if (2 == type_value &&  ''==orderIds) {
                    alert("订单编号 不可为空");
                    check_ = 0;
                }else if(1 == type_value &&  ''==beginDate){
                    alert("开始日期 不可为空");
                    check_ = 0;
                }else if(1 == type_value &&  ''==endDate){
                    alert("结束日期 不可为空");
                    check_ = 0;
                }

                var getDataFields = [
                    {field: "type", title: "任务类型", require: true, fileType: 10, select_content: getTypeSelect()},
                    {field: "taskName", title: "任务名称", require: true},
                    {field: "beginDateS", title: "开始日期" , fileType: 23, defaultValue: defaultValueDate},
                    {field: "endDateS", title: "结束日期" , fileType: 23, defaultValue: nowDefaultValueDate},
                    {field: "orderIds", title: "订单编号" , fileType: 27},
                ];

                if (check_) {

                    common_add(getDataFields, "/task/taobao/saveTask.action", tableId);
                }

            });
        });


        //删除按钮
        $("#btn_delete").click(function(){
            var row_=getChooseRawsJson(tableId);
            var ids=getChooseRawsIds(tableId,idField);
            if(ids==noChoose){
                alert("至少选择一项");
            }else if(ids.length==0){
                alert("选择项目脏乱数据，不可删除，请联系开发人员");
            }else{
                var row_=getChooseRawsJson(tableId);
                common_delete("/task/taobao/updateTaskuStatus.action?status=3",ids,idField,tableId);
            }
        });

        //重新运行
        $("#btn_edit").click(function(){
            var row_=getChooseRawsJson(tableId);
            var ids=getChooseRawsIds(tableId,idField);
            if(ids==noChoose){
                alert("至少选择一项");
            }else if(ids.length==0){
                alert("选择项目脏乱数据，不可重新运行，请联系开发人员");
            }else{
                var row_=getChooseRawsJson(tableId);
                common_delete("/task/taobao/updateTaskuStatus.action?status=1",ids,idField,tableId);
            }
        });



    });

    function initTypeChoose(typeValue) {
        if (1 == typeValue) {
            $("#form-group-beginDateS").show();
            $("#form-group-endDateS").show();
            $("#form-group-orderIds").hide();
        } else {
            $("#form-group-orderIds").show();
            $("#form-group-beginDateS").hide();
            $("#form-group-endDateS").hide();
        }
    }

</script>

<!-- 模态框（Modal） -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="addModal_Label">添加信息</h4>
            </div>
            <div class="modal-body">
                <form id="addModal_form" data-parsley-validate class="form-horizontal form-label-left">

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="addModal_save">提交</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal -->
</div>

</body>
</html>
